<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dasbor Evolusi Proyek Sepeda Filter</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Modern Blue/Slate with Green/Red accents -->
    <!-- Application Structure Plan: A more app-like structure with a sticky navigation header for better usability. The content is structured as a clear narrative: "The Challenge" (v1), "The Solution" (v2), and "Interactive Tools" (Simulators & AI). This flow guides the user from understanding the problem to exploring the improved system's capabilities, making the data more engaging. -->
    <!-- Visualization & Content Choices: 1. Key Metrics are now presented with icons and clearer labels. 2. A new "Upgraded Charging Efficiency" metric is added for direct comparison. 3. The design uses gradients, refined shadows, and hover effects for a more premium and interactive feel. 4. The core charts and simulators are retained but integrated into the new, more visually appealing layout. -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        :root {
            --scroll-padding: 5rem; /* Adjust based on nav height */
        }
        html {
            scroll-behavior: smooth;
            scroll-padding-top: var(--scroll-padding);
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f0f4f8; /* Lighter blue-ish gray */
        }
        .chart-container {
            position: relative;
            width: 100%;
            margin-left: auto;
            margin-right: auto;
        }
        .metric-card {
            background-color: white;
            border-radius: 0.75rem;
            padding: 1.5rem;
            border: 1px solid #e2e8f0;
            transition: transform 0.2s ease-in-out, box-shadow 0.2s ease-in-out;
        }
        .metric-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
        }
        .nav-link {
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            transition: background-color 0.2s, color 0.2s;
        }
        .nav-link.active, .nav-link:hover {
            background-color: #1e40af; /* Darker blue */
            color: white;
        }
        .section-header {
            background: linear-gradient(90deg, #3b82f6, #1d4ed8);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        .spinner {
            display: inline-block;
            width: 24px;
            height: 24px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #fff;
            animation: spin 1s ease-in-out infinite;
        }
        .prose {
            max-width: none;
        }
        .prose h3 {
            margin-bottom: 0.5em;
            font-size: 1.1em;
            font-weight: 600;
        }
        .prose ul {
            list-style-type: disc;
            padding-left: 1.5em;
            margin-top: 0.5em;
        }
        .prose li {
            margin-bottom: 0.25em;
        }
    </style>
</head>
<body class="text-slate-800">

    <header class="bg-white/80 backdrop-blur-lg sticky top-0 z-50 shadow-md">
        <nav class="container mx-auto px-6 py-3 flex justify-between items-center">
            <div class="text-xl font-extrabold text-blue-700">Sepeda Filter</div>
            <div class="hidden md:flex items-center space-x-2 font-semibold text-slate-600">
                <a href="#problem" class="nav-link">Tantangan</a>
                <a href="#solution" class="nav-link">Solusi</a>
                <a href="#interactive-simulators" class="nav-link">Simulator</a>
                <a href="#ai-assistant" class="nav-link">Asisten AI</a>
            </div>
        </nav>
    </header>

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <div class="text-center mb-16 mt-8">
            <h1 class="text-4xl md:text-5xl font-extrabold text-slate-900">Evolusi Sistem Sepeda Filter</h1>
            <p class="mt-4 text-lg text-slate-600 max-w-3xl mx-auto">Sebuah perjalanan dari identifikasi masalah defisit daya hingga solusi rekayasa yang efisien dan berkelanjutan.</p>
        </div>

        <main class="space-y-20">

            <!-- Section 1: The Initial Problem -->
            <section id="problem">
                <h2 class="text-3xl font-bold text-center mb-10"><span class="section-header">Tahap 1: Tantangan Sistem Awal</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mb-8">
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">‚ö° Daya Masuk</h3>
                        <p class="text-4xl font-bold text-green-600 mt-2">3.42<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">üî• Daya Keluar</h3>
                        <p class="text-4xl font-bold text-red-600 mt-2">50<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">üìâ Defisit Daya</h3>
                        <p class="text-4xl font-bold text-orange-600 mt-2">46.58<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">‚öôÔ∏è Efisiensi Charging</h3>
                        <p class="text-4xl font-bold text-blue-600 mt-2">6.8<span class="text-xl ml-1">%</span></p>
                    </div>
                </div>
                <div class="metric-card">
                    <h3 class="text-xl font-bold text-center mb-4">Rasio Pengisian vs Pemakaian: <span class="text-red-600">Sangat Tidak Efisien</span></h3>
                    <p class="text-center text-slate-600 mb-6">Untuk setiap 1 jam pemakaian, sistem awal membutuhkan waktu charging yang sangat lama.</p>
                    <div class="chart-container h-72 sm:h-80 max-w-2xl">
                        <canvas id="chargingImprovementChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Section 2: The Upgraded Solution -->
            <section id="solution">
                <h2 class="text-3xl font-bold text-center mb-10"><span class="section-header">Tahap 2: Solusi & Peningkatan Sistem</span></h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 text-center mb-8">
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">‚ö° Daya Masuk Baru</h3>
                        <p class="text-4xl font-bold text-green-600 mt-2">68.6<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">üî• Daya Keluar</h3>
                        <p class="text-4xl font-bold text-red-600 mt-2">50<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">üìà Surplus Daya</h3>
                        <p class="text-4xl font-bold text-green-600 mt-2">18.6<span class="text-xl ml-1">W</span></p>
                    </div>
                    <div class="metric-card">
                        <h3 class="text-lg font-semibold text-slate-500">‚öôÔ∏è Efisiensi Charging Baru</h3>
                        <p class="text-4xl font-bold text-blue-600 mt-2">137<span class="text-xl ml-1">%</span></p>
                    </div>
                </div>
                
                <div class="metric-card mb-8">
                     <h3 class="text-xl font-bold text-center mb-6">Spesifikasi Sistem Ditingkatkan</h3>
                     <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                         <div class="bg-slate-50 p-6 rounded-lg border-2 border-slate-200">
                             <h4 class="font-bold text-lg text-center mb-3">Opsi 1: Generator PMDC</h4>
                             <ul class="space-y-2 text-sm">
                                 <li><strong>Model:</strong> ZY82SL-2 (PMDC Treadmill)</li>
                                 <li><strong>Rated Power:</strong> 500 W</li>
                                 <li><strong>Kecepatan:</strong> 3400 RPM (Tinggi)</li>
                                 <li class="font-semibold text-orange-600">Kelayakan Mekanis: Menantang</li>
                             </ul>
                         </div>
                         <div class="bg-green-50 p-6 rounded-lg border-2 border-green-400">
                             <h4 class="font-bold text-lg text-center mb-3">Opsi 2: Generator BLDC (‚≠ê Pilihan Terbaik)</h4>
                             <ul class="space-y-2 text-sm">
                                 <li><strong>Model:</strong> E-bike Hub Motor (BLDC)</li>
                                 <li><strong>Rated Power:</strong> 350 W</li>
                                 <li><strong>Kecepatan:</strong> 800 RPM (Rendah)</li>
                                 <li class="font-semibold text-green-700">Kelayakan Mekanis: Sangat Layak</li>
                             </ul>
                         </div>
                     </div>
                </div>
            </section>

            <!-- Section 3: Interactive Simulators -->
            <section id="interactive-simulators">
                <h2 class="text-3xl font-bold text-center mb-10"><span class="section-header">Tahap 3: Kalkulator & Simulator Interaktif</span></h2>
                <div class="metric-card mb-8">
                    <label for="system-selector" class="block text-lg font-bold mb-2 text-center">Pilih Konfigurasi Sistem:</label>
                    <select id="system-selector" class="w-full max-w-md mx-auto block p-3 border border-slate-300 rounded-lg text-lg focus:ring-2 focus:ring-blue-500">
                        <option value="initial">Sistem Awal</option>
                        <option value="option1">Opsi 1: PMDC Ditingkatkan</option>
                        <option value="option2" selected>Opsi 2: BLDC Ditingkatkan</option>
                    </select>
                </div>

                <div class="space-y-8">
                    <!-- Pedaling Energy Calculator -->
                     <div class="metric-card">
                        <h3 class="text-xl font-bold mb-4 text-center">üö≤ Kalkulator Energi Kayuhan</h3>
                        <p class="text-slate-600 mb-6 text-center">Masukkan berapa lama Anda mengayuh untuk melihat energi yang dihasilkan dan perbandingannya antar sistem.</p>
                        <div class="max-w-md mx-auto">
                            <label for="pedaling-time-input" class="block mb-2 font-medium text-slate-700">Lama Mengayuh (Menit)</label>
                            <input type="number" id="pedaling-time-input" value="10" min="1" class="w-full p-2 border border-slate-300 rounded-lg">
                        </div>
                        <div class="mt-6 grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                            <div class="bg-red-50 p-4 rounded-lg border border-red-200">
                                <h4 class="font-bold text-red-800">Sistem Awal</h4>
                                <p class="text-2xl font-bold text-red-900 mt-2"><span id="pedal-initial-runtime">...</span></p>
                                <p class="text-sm text-red-700">Waktu Operasi</p>
                            </div>
                            <div class="bg-yellow-50 p-4 rounded-lg border border-yellow-200">
                                <h4 class="font-bold text-yellow-800">Opsi 1 (PMDC)</h4>
                                <p class="text-2xl font-bold text-yellow-900 mt-2"><span id="pedal-option1-runtime">...</span></p>
                                <p class="text-sm text-yellow-700">Waktu Operasi</p>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg border border-green-200">
                                <h4 class="font-bold text-green-800">Opsi 2 (BLDC)</h4>
                                <p class="text-2xl font-bold text-green-900 mt-2"><span id="pedal-option2-runtime">...</span></p>
                                <p class="text-sm text-green-700">Waktu Operasi</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Main Simulator -->
                    <div class="metric-card">
                        <h3 class="text-xl font-bold mb-4 text-center">üîã‚ö° Simulator Aki & Pengisian Daya</h3>
                        <p class="text-slate-600 mb-6 text-center">Geser slider untuk melihat bagaimana level aki mempengaruhi waktu operasi dan kebutuhan charging.</p>
                        
                        <label for="battery-level-slider" class="block mb-2 font-medium text-slate-700">Level Aki Saat Ini: <span id="battery-level-value" class="font-bold text-blue-600">100%</span></label>
                        <input type="range" id="battery-level-slider" min="0" max="100" value="100" class="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer">
                        
                        <div class="mt-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 text-center">
                            <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-600">Waktu Operasi Tersisa</p>
                                <p class="text-3xl font-bold text-slate-800"><span id="runtime-value">...</span></p>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-600">Kapasitas Tersedia</p>
                                <p class="text-3xl font-bold text-slate-800"><span id="capacity-value">...</span> Wh</p>
                            </div>
                            <div class="bg-slate-100 p-4 rounded-lg">
                                <p class="text-sm font-medium text-slate-600">Waktu Charge ke 100%</p>
                                <p class="text-3xl font-bold text-slate-800"><span id="charge-to-full-value">...</span></p>
                            </div>
                        </div>
                    </div>

                     <!-- Usage Time Calculator -->
                    <div class="metric-card">
                        <h3 class="text-xl font-bold mb-4 text-center">‚è≥ Kalkulator Waktu Charging</h3>
                        <p class="text-slate-600 mb-6 text-center">Masukkan berapa lama Anda ingin menggunakan sistem untuk melihat waktu charging yang diperlukan.</p>
                        <div class="max-w-md mx-auto">
                           <label for="usage-time-input" class="block mb-2 font-medium text-slate-700">Waktu Pemakaian yang Diinginkan (Jam)</label>
                           <input type="number" id="usage-time-input" value="1" min="0.1" step="0.1" class="w-full p-2 border border-slate-300 rounded-lg">
                        </div>
                        <div class="mt-6 text-center bg-blue-50 p-4 rounded-lg border border-blue-200">
                           <p class="text-sm font-medium text-blue-800">Waktu Charging yang Dibutuhkan</p>
                           <p class="text-3xl font-bold text-blue-900 mt-2"><span id="usage-charge-time">...</span></p>
                        </div>
                    </div>
                    
                    <!-- Water Needs Calculator -->
                    <div class="metric-card">
                        <h3 class="text-xl font-bold mb-4 text-center">üíß Kalkulator Keperluan Air</h3>
                        <p class="text-slate-600 mb-6 text-center">Masukkan kebutuhan air untuk menghitung waktu produksi dan konsumsi daya aki.</p>
                        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                            <div>
                                <label for="uf-water-input" class="block mb-1 font-medium text-slate-700">Air Bersih (UF) (Liter)</label>
                                <input type="number" id="uf-water-input" value="70" min="0" class="w-full p-2 border border-slate-300 rounded-lg">
                            </div>
                            <div>
                                <label for="ro-water-input" class="block mb-1 font-medium text-slate-700">Air Minum (RO) (Liter)</label>
                                <input type="number" id="ro-water-input" value="2" min="0" class="w-full p-2 border border-slate-300 rounded-lg">
                            </div>
                        </div>
                        <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4 text-center">
                            <div class="bg-slate-100 p-3 rounded-lg">
                                <p class="text-sm font-medium text-slate-600">Total Waktu Produksi</p>
                                <p class="text-2xl font-bold text-slate-800"><span id="water-prod-time">...</span></p>
                            </div>
                            <div class="bg-slate-100 p-3 rounded-lg">
                                <p class="text-sm font-medium text-slate-600">Daya Aki Digunakan</p>
                                <p class="text-2xl font-bold text-slate-800"><span id="water-battery-usage">...</span></p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
            
            <!-- Section 4: AI Assistant -->
            <section id="ai-assistant">
                <h2 class="text-3xl font-bold text-center mb-10"><span class="section-header">Tahap 4: Asisten Proyek Cerdas</span></h2>
                <div class="metric-card">
                    <div class="space-y-4">
                        <label for="ai-prompt" class="font-medium text-slate-700">Ajukan pertanyaan tentang rekayasa mekanis, perawatan, atau ide pengembangan lainnya:</label>
                        <textarea id="ai-prompt" rows="3" class="w-full p-2 border border-slate-300 rounded-lg" placeholder="Contoh: Berikan saya ide untuk desain transmisi gir rasio 10:1 yang efisien dan tidak berisik."></textarea>
                        
                        <div class="flex flex-wrap gap-2">
                            <button class="suggestion-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 py-1 px-3 rounded-full">Ide desain transmisi 10:1</button>
                            <button class="suggestion-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 py-1 px-3 rounded-full">Buat jadwal perawatan sistem</button>
                            <button class="suggestion-btn text-sm bg-slate-200 hover:bg-slate-300 text-slate-800 py-1 px-3 rounded-full">Potensi risiko & mitigasinya</button>
                        </div>

                        <button id="submit-ai" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 px-4 rounded-lg flex items-center justify-center transition-colors">
                            <span id="submit-ai-text">Kirim Pertanyaan</span>
                            <div id="submit-ai-spinner" class="spinner" style="display: none;"></div>
                        </button>
                    </div>

                    <div id="ai-response-container" class="mt-6" style="display: none;">
                        <h3 class="text-lg font-bold border-b pb-2 mb-3">Jawaban dari Asisten AI:</h3>
                        <div id="ai-response" class="prose text-slate-700 bg-slate-50 p-4 rounded-lg"></div>
                    </div>
                </div>
            </section>

            <!-- Section 5: Conclusion -->
            <section id="kesimpulan">
                <h2 class="text-3xl font-bold text-center mb-10"><span class="section-header">Kesimpulan Akhir & Langkah Selanjutnya</span></h2>
                <div class="metric-card space-y-4">
                    <div class="flex items-start">
                        <span class="text-green-500 font-bold text-2xl mr-4">‚úì</span>
                        <div>
                            <h4 class="font-bold text-slate-800">Masalah Terpecahkan</h4>
                            <p>Sistem yang ditingkatkan berhasil mengatasi defisit daya, mengubah rasio charging dari 14.6 jam menjadi hanya 44 menit untuk setiap 1 jam pemakaian.</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="text-green-500 font-bold text-2xl mr-4">‚úì</span>
                        <div>
                            <h4 class="font-bold text-slate-800">Surplus Energi</h4>
                            <p>Sistem kini mampu mengisi daya lebih cepat daripada mengkonsumsinya, menjadikannya praktis dan dapat diandalkan untuk penggunaan rutin di lapangan.</p>
                        </div>
                    </div>
                    <div class="flex items-start">
                        <span class="text-blue-500 font-bold text-2xl mr-4">‚Üí</span>
                        <div>
                            <h4 class="font-bold text-slate-800">Fokus Selanjutnya: Rekayasa Mekanis</h4>
                            <p>Tantangan utama kini beralih ke perancangan dan implementasi sistem transmisi (gir rasio ~10:1) yang efisien dan ergonomis.</p>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <footer class="text-center mt-20 pt-8 border-t border-slate-200">
            <p class="text-sm text-slate-500">&copy; 2024 Dasbor Evolusi Sepeda Filter. Analisis komprehensif untuk inovasi berkelanjutan.</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- System Data ---
            const systems = {
                initial: {
                    name: 'Sistem Awal',
                    powerIn: 3.42,
                    powerOut: 50,
                    batteryWh: 240,
                    waterUF_LPM: 6.7,
                    waterRO_LPM: 0.4,
                },
                option1: {
                    name: 'Opsi 1: PMDC Ditingkatkan',
                    powerIn: 68.6,
                    powerOut: 50,
                    batteryWh: 240,
                    waterUF_LPM: 6.7,
                    waterRO_LPM: 0.4,
                },
                option2: {
                    name: 'Opsi 2: BLDC Ditingkatkan',
                    powerIn: 68.6,
                    powerOut: 50,
                    batteryWh: 240,
                    waterUF_LPM: 6.7,
                    waterRO_LPM: 0.4,
                }
            };

            // --- Chart 2: Charging Improvement ---
            const improvementCtx = document.getElementById('chargingImprovementChart').getContext('2d');
            const initialChargeRatio = systems.initial.powerOut / systems.initial.powerIn;
            const upgradedChargeRatio = systems.option2.powerOut / systems.option2.powerIn;
            new Chart(improvementCtx, {
                type: 'bar',
                data: {
                    labels: ['Waktu Charging untuk 1 Jam Pakai'],
                    datasets: [
                        {
                            label: 'Sistem Awal',
                            data: [initialChargeRatio],
                            backgroundColor: '#f87171', // Lighter red
                            borderColor: '#ef4444',
                            borderWidth: 2,
                            borderRadius: 5,
                        },
                        {
                            label: 'Sistem Ditingkatkan',
                            data: [upgradedChargeRatio],
                            backgroundColor: '#4ade80', // Lighter green
                            borderColor: '#22c55e',
                            borderWidth: 2,
                            borderRadius: 5,
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: { display: true, text: 'Waktu (Jam)' }
                        }
                    },
                    plugins: {
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    let value = context.parsed.y;
                                    return `${context.dataset.label}: ${formatTime(value)}`;
                                }
                            }
                        }
                    }
                }
            });

            // --- Interactive Simulators Logic ---
            const systemSelector = document.getElementById('system-selector');
            const batterySlider = document.getElementById('battery-level-slider');
            const batteryLevelValue = document.getElementById('battery-level-value');
            const runtimeValueEl = document.getElementById('runtime-value');
            const capacityValueEl = document.getElementById('capacity-value');
            const chargeToFullValueEl = document.getElementById('charge-to-full-value');
            
            const usageTimeInput = document.getElementById('usage-time-input');
            const usageChargeTimeEl = document.getElementById('usage-charge-time');
            
            const pedalingTimeInput = document.getElementById('pedaling-time-input');
            const pedalInitialRuntimeEl = document.getElementById('pedal-initial-runtime');
            const pedalOption1RuntimeEl = document.getElementById('pedal-option1-runtime');
            const pedalOption2RuntimeEl = document.getElementById('pedal-option2-runtime');

            const ufWaterInput = document.getElementById('uf-water-input');
            const roWaterInput = document.getElementById('ro-water-input');
            const waterProdTimeEl = document.getElementById('water-prod-time');
            const waterBatteryUsageEl = document.getElementById('water-battery-usage');

            function formatTime(hours) {
                if (isNaN(hours) || hours <= 0) return '0 menit';
                if (hours < 1) {
                    return `${Math.round(hours * 60)} menit`;
                }
                const h = Math.floor(hours);
                const m = Math.round((hours - h) * 60);
                if (m === 60) {
                    return `${h + 1} jam`;
                }
                return `${h} jam ${m} mnt`;
            }

            function updateAllSimulators() {
                const selectedSystemKey = systemSelector.value;
                const system = systems[selectedSystemKey];
                const batteryLevel = batterySlider.value;

                // Update Battery & Runtime Simulator
                batteryLevelValue.textContent = `${batteryLevel}%`;
                const availableWh = system.batteryWh * (batteryLevel / 100);
                capacityValueEl.textContent = availableWh.toFixed(1);
                const runtimeHours = availableWh / system.powerOut;
                runtimeValueEl.textContent = formatTime(runtimeHours);
                
                const neededWh = system.batteryWh - availableWh;
                const chargeToFullHours = neededWh / system.powerIn;
                chargeToFullValueEl.textContent = formatTime(chargeToFullHours);
                
                // Update Usage Time Calculator
                const usageHours = parseFloat(usageTimeInput.value) || 0;
                const requiredChargeHours = usageHours * (system.powerOut / system.powerIn);
                usageChargeTimeEl.textContent = formatTime(requiredChargeHours);

                // Update Pedaling Calculator
                const pedalingMinutes = parseFloat(pedalingTimeInput.value) || 0;
                Object.keys(systems).forEach(key => {
                    const currentSys = systems[key];
                    const energyGeneratedWh = (pedalingMinutes / 60) * currentSys.powerIn;
                    const runtimeGeneratedHours = energyGeneratedWh / currentSys.powerOut;
                    const runtimeGeneratedFormatted = formatTime(runtimeGeneratedHours);
                    document.getElementById(`pedal-${key}-runtime`).textContent = runtimeGeneratedFormatted;
                });

                // Update Water Needs Calculator
                const ufLiters = parseFloat(ufWaterInput.value) || 0;
                const roLiters = parseFloat(roWaterInput.value) || 0;
                const timeForUf = system.waterUF_LPM > 0 ? ufLiters / system.waterUF_LPM : 0;
                const timeForRo = system.waterRO_LPM > 0 ? roLiters / system.waterRO_LPM : 0;
                const totalTimeMinutes = timeForUf + timeForRo;
                waterProdTimeEl.textContent = formatTime(totalTimeMinutes / 60);
                const totalTimeHours = totalTimeMinutes / 60;
                const energyConsumedWh = system.powerOut * totalTimeHours;
                const batteryPercentUsed = (energyConsumedWh / system.batteryWh) * 100;
                waterBatteryUsageEl.textContent = `${batteryPercentUsed.toFixed(1)} %`;
            }

            systemSelector.addEventListener('change', updateAllSimulators);
            batterySlider.addEventListener('input', updateAllSimulators);
            usageTimeInput.addEventListener('input', updateAllSimulators);
            pedalingTimeInput.addEventListener('input', updateAllSimulators);
            ufWaterInput.addEventListener('input', updateAllSimulators);
            roWaterInput.addEventListener('input', updateAllSimulators);
            
            // --- AI Assistant Logic ---
            const aiPromptEl = document.getElementById('ai-prompt');
            const submitAiBtn = document.getElementById('submit-ai');
            const submitAiText = document.getElementById('submit-ai-text');
            const submitAiSpinner = document.getElementById('submit-ai-spinner');
            const aiResponseContainer = document.getElementById('ai-response-container');
            const aiResponseEl = document.getElementById('ai-response');
            const suggestionBtns = document.querySelectorAll('.suggestion-btn');

            suggestionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    aiPromptEl.value = btn.textContent;
                    submitAiBtn.click();
                });
            });
            
            submitAiBtn.addEventListener('click', () => {
                const userPrompt = aiPromptEl.value;
                if (!userPrompt.trim()) {
                    alert('Mohon masukkan pertanyaan Anda.');
                    return;
                }
                callGeminiAPI(userPrompt);
            });

            async function callGeminiAPI(userPrompt) {
                setLoading(true);
                aiResponseContainer.style.display = 'block';
                aiResponseEl.innerHTML = 'Memproses jawaban...';

                const fullPrompt = `Anda adalah seorang ahli rekayasa mekanik dan sistem. Berdasarkan konteks sebuah proyek "Sepeda Filter" yang bertujuan untuk menyediakan air bersih di daerah terpencil, jawablah pertanyaan berikut.
                
                Konteks Sistem:
                - Sumber Tenaga: Kayuhan manusia, menghasilkan daya mekanis sekitar 100W.
                - Generator: Motor BLDC 350W, dioperasikan sebagai generator.
                - Target Mekanis: Mencapai rasio gir sekitar 10:1 untuk mengubah kayuhan RPM rendah menjadi RPM tinggi yang dibutuhkan generator.
                - Penyimpanan Energi: Aki 12V 20Ah.
                - Kontroler: SCC MPPT 30A.
                - Beban: Pompa dan sistem filter yang membutuhkan daya 50W.
                
                Pertanyaan Pengguna: "${userPrompt}"

                Berikan jawaban yang terstruktur, praktis, dan mudah dipahami. Gunakan daftar (bullet points) jika memungkinkan untuk menjelaskan langkah-langkah atau komponen.`;

                const apiKey = ""; 
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;
                
                try {
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({
                            contents: [{
                                parts: [{
                                    text: fullPrompt
                                }]
                            }]
                        })
                    });

                    if (!response.ok) {
                        throw new Error(`API Error: ${response.status} ${response.statusText}`);
                    }

                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 && result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        aiResponseEl.innerHTML = formatResponse(text);
                    } else {
                        aiResponseEl.textContent = 'Maaf, tidak ada jawaban yang dapat dihasilkan. Coba lagi.';
                    }

                } catch (error) {
                    console.error("Error calling Gemini API:", error);
                    aiResponseEl.textContent = 'Terjadi kesalahan saat menghubungi asisten AI. Mohon periksa koneksi Anda dan coba lagi.';
                } finally {
                    setLoading(false);
                }
            }

            function setLoading(isLoading) {
                if (isLoading) {
                    submitAiBtn.disabled = true;
                    submitAiText.style.display = 'none';
                    submitAiSpinner.style.display = 'inline-block';
                } else {
                    submitAiBtn.disabled = false;
                    submitAiText.style.display = 'inline-block';
                    submitAiSpinner.style.display = 'none';
                }
            }

            function formatResponse(text) {
                // Simple markdown-like formatting for lists and bold text
                return text
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>') // Bold
                    .replace(/^\* (.*$)/gm, '<li>$1</li>') // List items
                    .replace(/(\<li\>.*\<\/li\>)/gs, '<ul>$1</ul>') // Wrap lists
                    .replace(/\n/g, '<br>');
            }

            // Initial calculations
            updateAllSimulators();
        });
    </script>
</body>
</html>
